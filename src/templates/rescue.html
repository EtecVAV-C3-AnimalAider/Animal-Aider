{% extends 'base.html' %}
{% block conteudo %}
<form action="{{ url_for('rescue')}}" method="post" enctype="multipart/form-data">
    
    <!-- Campos sempre obrigatórios -->
    <div>
        <label for="desc">Descrição:</label>
        <textarea class="form-control" name="desc" id="desc" required></textarea>
    </div>
    
    <div>
        <label for="city">Cidade:</label>
        <select name="city" id="city" class="form-control" required>
            <option value="">Selecione uma cidade</option>
            {% for city in cities %}
                <option value="{{ city }}">{{ city }}</option>
            {% endfor %}
        </select>
    </div>
    
    <!-- Campos opcionais de endereço -->
    <div>
        <label for="cep">CEP:</label>
        <input type="text" name="cep" id="cep" class="form-control">
    </div>
    
    <div>
        <label for="addr">Endereço:</label>
        <input type="text" name="addr" id="addr" class="form-control">
    </div>
    
    <div>
        <label for="num">Número:</label>
        <input type="text" name="num" id="num" class="form-control">
    </div>
    
    <!-- Campos condicionais baseados no login -->
    {% if not session.get('logged') %}
        <!-- Para usuários NÃO logados - campos obrigatórios -->
        <div>
            <label for="author">Nome do autor:</label>
            <input type="text" name="author" id="author" class="form-control" required>
        </div>
        
        <div>
            <label for="phone">Telefone para contato:</label>
            <input type="tel" name="phone" id="phone" class="form-control" required>
        </div>
        
        <div>
            <label for="photo">Foto do animal:</label>
            <input type="file" name="photo" id="photo" class="form-control" accept="image/*" required>
        </div>
        
    {% else %}
        <!-- Para usuários logados -->
        <div>
            <label for="photo">Foto do animal:</label>
            <input type="file" name="photo" id="photo" class="form-control" accept="image/*" required>
        </div>
        
        <!-- Informações do usuário logado são obtidas da sessão no backend -->
        <div class="alert alert-info">
            <strong>Dados do usuário:</strong><br>
            Nome: {{ session.get('user_name', 'Não informado') }}<br>
            {% if session.get('user_phone') %}
                Telefone: {{ session.get('user_phone') }}<br>
            {% endif %}
        </div>
    {% endif %}
    
    <div>
        <button type="submit" class="btn btn-primary">Registrar Resgate</button>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">Cancelar</a>
    </div>
</form>
{% endblock conteudo %}